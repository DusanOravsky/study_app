<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Mentor - LocalStorage Demo Version</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  
  <style>
    @keyframes slide-up {
      from { transform: translateY(100px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }
    .animate-slide-up { animation: slide-up 0.3s ease-out; }
    .animate-shimmer { animation: shimmer 2s infinite; }
    .line-clamp-2 {
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useCallback } = React;

    // ========================================================================
    // LOCALSTORAGE FUNCTIONS (namiesto Firebase)
    // ========================================================================
    
    const storage = {
      get: (key) => {
        try {
          const item = localStorage.getItem(key);
          return item ? JSON.parse(item) : null;
        } catch (e) {
          console.error('Storage get error:', e);
          return null;
        }
      },
      set: (key, value) => {
        try {
          localStorage.setItem(key, JSON.stringify(value));
          return true;
        } catch (e) {
          console.error('Storage set error:', e);
          return false;
        }
      },
      remove: (key) => {
        try {
          localStorage.removeItem(key);
          return true;
        } catch (e) {
          console.error('Storage remove error:', e);
          return false;
        }
      }
    };

    // ========================================================================
    // HELPER FUNCTIONS
    // ========================================================================
    
    const removeDiacritics = (str) => {
      return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    };

    const formatTime = (seconds) => {
      const mins = Math.floor(seconds / 60);
      const secs = seconds % 60;
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    };

    const getSuccessRate = (correct, total) => {
      if (total === 0) return 0;
      return Math.round((correct / total) * 100);
    };

    const gcd = (a, b) => b === 0 ? a : gcd(b, a % b);

    const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

    // ========================================================================
    // SMART RANDOM QUESTION GENERATOR
    // ========================================================================
    
    const generateMathQuestion = (difficulty) => {
      const type = ['zlomky_scitanie', 'zlomky_odcitanie', 'geometria_obvod'][randomInt(0, 2)];
      
      if (type === 'zlomky_scitanie') {
        // Jednoduch√© zlomky pre 5. roƒçn√≠k (v√Ωsledok cel√© ƒç√≠slo alebo jednoduch√Ω zlomok)
        const options = [
          { c1: 1, m1: 2, c2: 1, m2: 2, ans: '1' },
          { c1: 1, m1: 4, c2: 1, m2: 4, ans: '1/2' },
          { c1: 1, m1: 3, c2: 1, m2: 3, ans: '2/3' },
          { c1: 2, m1: 5, c2: 1, m1: 5, ans: '3/5' },
        ];
        const selected = options[randomInt(0, options.length - 1)];
        
        return {
          question: `${selected.c1}/${selected.m1} + ${selected.c2}/${selected.m2}`,
          answer: selected.ans,
          steps: [
            `1. Spoloƒçn√Ω menovateƒæ`,
            `2. Sƒç√≠taj ƒçitatele`,
            `3. V√Ωsledok: ${selected.ans}`
          ],
          difficulty: 1,
          topic: 'zlomky'
        };
      }
      
      if (type === 'zlomky_odcitanie') {
        const options = [
          { c1: 3, m1: 4, c2: 1, m2: 4, ans: '1/2' },
          { c1: 2, m1: 3, c2: 1, m2: 3, ans: '1/3' },
          { c1: 4, m1: 5, c2: 1, m2: 5, ans: '3/5' },
        ];
        const selected = options[randomInt(0, options.length - 1)];
        
        return {
          question: `${selected.c1}/${selected.m1} - ${selected.c2}/${selected.m2}`,
          answer: selected.ans,
          steps: [
            `1. Spoloƒçn√Ω menovateƒæ`,
            `2. Odƒç√≠taj ƒçitatele`,
            `3. V√Ωsledok: ${selected.ans}`
          ],
          difficulty: 1,
          topic: 'zlomky'
        };
      }
      
      if (type === 'geometria_obvod') {
        const a = randomInt(5, 20);
        const b = randomInt(3, 15);
        const obvod = 2 * (a + b);
        
        return {
          question: `Obdƒ∫≈ænik: a=${a}cm, b=${b}cm. Obvod?`,
          answer: `${obvod}`,
          steps: [
            `1. Vzorec: O = 2(a + b)`,
            `2. O = 2(${a} + ${b}) = ${obvod}cm`
          ],
          difficulty: 1,
          topic: 'geometria'
        };
      }
    };

    const generateSJLQuestion = () => {
      const words = {
        'podstatn√© meno': ['strom', 'mama', 'pes', 'dom', '≈°kola'],
        'pr√≠davn√© meno': ['pekn√Ω', 'veƒæk√Ω', 'mal√Ω', 'dobr√Ω'],
        'sloveso': ['be≈æ√≠', 'var√≠', 'p√≠≈°e', 'ƒç√≠ta'],
      };
      
      const typ = Object.keys(words)[randomInt(0, Object.keys(words).length - 1)];
      const slovo = words[typ][randomInt(0, words[typ].length - 1)];
      
      return {
        question: `Urƒçi slovn√Ω druh: "${slovo}"`,
        answer: typ,
        steps: [`1. ${typ}`],
        difficulty: 1,
        topic: 'slovn√© druhy'
      };
    };

    // ========================================================================
    // MAIN APP COMPONENT
    // ========================================================================
    
    function App() {
      // Load profile from localStorage
      const [profile, setProfile] = useState(() => {
        const saved = storage.get('ai_mentor_profile');
        return saved || {
          name: "≈†tudent",
          tier: 'free',
          totalQuestions: 0,
          correctAnswers: 0,
          points: 0,
          level: 1,
          xp: 0,
          xpToNextLevel: 100,
          currentStreak: 0,
          longestStreak: 0,
          history: []
        };
      });

      // Save profile to localStorage whenever it changes
      useEffect(() => {
        storage.set('ai_mentor_profile', profile);
      }, [profile]);

      const [userRole, setUserRole] = useState(null);
      const [examType, setExamType] = useState(null);
      const [subject, setSubject] = useState(null);
      const [currentQ, setCurrentQ] = useState(null);
      const [phase, setPhase] = useState('example');
      const [approach, setApproach] = useState('');
      const [approachResult, setApproachResult] = useState(null);
      const [answer, setAnswer] = useState('');
      const [feedback, setFeedback] = useState(null);
      const [toast, setToast] = useState(null);

      const showToast = (message, type = 'info') => {
        setToast({ message, type });
        setTimeout(() => setToast(null), 3000);
      };

      const loadQ = () => {
        let q;
        if (subject === 'matematika') {
          q = generateMathQuestion(1);
        } else if (subject === 'sjl') {
          q = generateSJLQuestion();
        }
        
        if (q) {
          setCurrentQ(q);
          setPhase('example');
          setApproach('');
          setApproachResult(null);
          setAnswer('');
          setFeedback(null);
        }
      };

      const checkAnswer = () => {
        const userAns = answer.trim().toLowerCase();
        const correctAns = currentQ.answer.toLowerCase();
        
        const isCorrect = userAns === correctAns || 
                         removeDiacritics(userAns) === removeDiacritics(correctAns);
        
        const message = isCorrect ? "‚úÖ V√Ωborne!" : `‚ùå Spr√°vne: ${currentQ.answer}`;
        
        setFeedback({ correct: isCorrect, message });
        setPhase('feedback');
        
        // Update profile
        const xpGained = isCorrect ? 15 : 5;
        const newXP = profile.xp + xpGained;
        let newLevel = profile.level;
        let xpToNext = profile.xpToNextLevel;
        
        if (newXP >= xpToNext) {
          newLevel++;
          xpToNext = newLevel * 100;
          showToast(`üéâ Level Up! Level ${newLevel}!`, 'success');
        }
        
        setProfile(prev => ({
          ...prev,
          totalQuestions: prev.totalQuestions + 1,
          correctAnswers: prev.correctAnswers + (isCorrect ? 1 : 0),
          points: prev.points + (isCorrect ? 10 : 5),
          xp: newXP,
          level: newLevel,
          xpToNextLevel: xpToNext,
          history: [...prev.history.slice(-99), {
            question: currentQ.question,
            correct: isCorrect,
            timestamp: Date.now()
          }]
        }));
      };

      // ========================================================================
      // RENDER: Role Selection
      // ========================================================================
      
      if (!userRole) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-200 via-purple-200 to-pink-200 p-8">
            <div className="max-w-6xl mx-auto">
              {/* Banner */}
              <div className="bg-yellow-100 border-4 border-yellow-500 rounded-2xl p-6 mb-8">
                <p className="text-2xl font-bold text-yellow-900 text-center">
                  üß™ LocalStorage DEMO verzia (v≈°etko funguje lok√°lne)
                </p>
                <p className="text-center text-yellow-800 mt-2">
                  D√°ta sa ulo≈æia v prehliadaƒçi ‚Ä¢ ≈Ωiadna registr√°cia ‚Ä¢ Testovacia verzia
                </p>
              </div>

              {/* Title */}
              <div className="text-center mb-16">
                <h1 className="text-6xl font-bold mb-4 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent">
                  AI Mentor
                </h1>
                <p className="text-3xl text-gray-700 font-bold">Adapt√≠vny Tr√©ning</p>
              </div>

              {/* Role cards */}
              <div className="grid md:grid-cols-3 gap-8">
                <button 
                  onClick={() => setUserRole('student')}
                  className="p-12 bg-gradient-to-br from-blue-500 via-cyan-500 to-teal-500 text-white rounded-3xl shadow-2xl hover:scale-110 transition-all"
                >
                  <div className="text-6xl mb-4">üìö</div>
                  <h3 className="text-4xl font-bold mb-2">≈Ωiak</h3>
                  <p className="text-lg">Zaƒçni tr√©nova≈•</p>
                </button>

                <button 
                  onClick={() => setUserRole('parent')}
                  className="p-12 bg-gradient-to-br from-purple-500 via-pink-500 to-red-500 text-white rounded-3xl shadow-2xl hover:scale-110 transition-all"
                >
                  <div className="text-6xl mb-4">üë®‚Äçüë©‚Äçüëß</div>
                  <h3 className="text-4xl font-bold mb-2">Rodiƒç</h3>
                  <p className="text-lg">Sleduj pokrok</p>
                </button>

                <button 
                  onClick={() => setUserRole('teacher')}
                  className="p-12 bg-gradient-to-br from-green-500 via-emerald-500 to-teal-500 text-white rounded-3xl shadow-2xl hover:scale-110 transition-all"
                >
                  <div className="text-6xl mb-4">üéØ</div>
                  <h3 className="text-4xl font-bold mb-2">Uƒçiteƒæ</h3>
                  <p className="text-lg">Spravuj triedu</p>
                </button>
              </div>

              {/* Stats */}
              <div className="mt-12 grid md:grid-cols-4 gap-4">
                <div className="bg-white rounded-xl p-4 shadow-lg text-center">
                  <div className="text-3xl font-bold text-blue-600">{profile.totalQuestions}</div>
                  <div className="text-sm text-gray-600">√ölohy celkom</div>
                </div>
                <div className="bg-white rounded-xl p-4 shadow-lg text-center">
                  <div className="text-3xl font-bold text-green-600">{getSuccessRate(profile.correctAnswers, profile.totalQuestions)}%</div>
                  <div className="text-sm text-gray-600">√öspe≈°nos≈•</div>
                </div>
                <div className="bg-white rounded-xl p-4 shadow-lg text-center">
                  <div className="text-3xl font-bold text-yellow-600">{profile.points}</div>
                  <div className="text-sm text-gray-600">Body</div>
                </div>
                <div className="bg-white rounded-xl p-4 shadow-lg text-center">
                  <div className="text-3xl font-bold text-purple-600">L{profile.level}</div>
                  <div className="text-sm text-gray-600">Level</div>
                </div>
              </div>
            </div>

            {toast && (
              <div className={`fixed bottom-6 right-6 px-6 py-4 rounded-xl shadow-2xl text-white font-bold animate-slide-up ${
                toast.type === 'success' ? 'bg-green-500' : 
                toast.type === 'error' ? 'bg-red-500' : 'bg-blue-500'
              }`}>
                {toast.message}
              </div>
            )}
          </div>
        );
      }

      // ========================================================================
      // RENDER: Exam Selection
      // ========================================================================
      
      if (!examType) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-green-200 via-teal-200 to-cyan-200 p-8">
            <div className="max-w-5xl mx-auto">
              <button onClick={() => setUserRole(null)} className="mb-8 px-4 py-2 bg-white rounded-xl shadow">
                ‚Üê Sp√§≈•
              </button>
              
              <h2 className="text-5xl font-bold mb-12 text-center">Vyber typ sk√∫≈°ky</h2>
              
              <div className="grid md:grid-cols-2 gap-8">
                <button 
                  onClick={() => setExamType("8-rocne")}
                  className="p-8 bg-gradient-to-r from-orange-400 to-pink-400 text-white rounded-3xl shadow-2xl hover:scale-105 transition"
                >
                  <div className="text-5xl mb-4">üéì</div>
                  <h3 className="text-3xl font-bold mb-2">8-roƒçn√© gymn√°zium</h3>
                  <p className="text-lg">5. roƒçn√≠k Z≈†</p>
                  <div className="mt-4 flex gap-2 justify-center">
                    <span className="px-3 py-1 bg-white bg-opacity-30 rounded-full text-sm">Matematika</span>
                    <span className="px-3 py-1 bg-white bg-opacity-30 rounded-full text-sm">SJL</span>
                  </div>
                </button>

                <button 
                  onClick={() => setExamType("4-rocne")}
                  className="p-8 bg-gradient-to-r from-purple-400 to-pink-400 text-white rounded-3xl shadow-2xl hover:scale-105 transition"
                >
                  <div className="text-5xl mb-4">üìö</div>
                  <h3 className="text-3xl font-bold mb-2">4-roƒçn√© gymn√°zium</h3>
                  <p className="text-lg">9. roƒçn√≠k Z≈†</p>
                  <div className="mt-4 flex gap-2 justify-center">
                    <span className="px-3 py-1 bg-white bg-opacity-30 rounded-full text-sm">Matematika</span>
                    <span className="px-3 py-1 bg-white bg-opacity-30 rounded-full text-sm">SJL</span>
                    <span className="px-3 py-1 bg-white bg-opacity-30 rounded-full text-sm">Angliƒçtina</span>
                  </div>
                </button>
              </div>
            </div>
          </div>
        );
      }

      // ========================================================================
      // RENDER: Subject Selection
      // ========================================================================
      
      if (!subject) {
        const subjects = examType === "8-rocne" ? ["matematika", "sjl"] : ["matematika", "sjl", "anglictina"];
        const subjectInfo = {
          matematika: { name: "Matematika", color: "from-blue-400 to-cyan-400", icon: "üî¢" },
          sjl: { name: "Slovensk√Ω jazyk", color: "from-purple-400 to-pink-400", icon: "üìñ" },
          anglictina: { name: "Angliƒçtina", color: "from-green-400 to-emerald-400", icon: "üá¨üáß" }
        };
        
        return (
          <div className="min-h-screen bg-gradient-to-br from-yellow-200 via-orange-200 to-red-200 p-8">
            <div className="max-w-4xl mx-auto">
              <button onClick={() => setExamType(null)} className="mb-8 px-4 py-2 bg-white rounded-xl shadow">
                ‚Üê Sp√§≈•
              </button>
              
              <h2 className="text-5xl font-bold mb-12 text-center">Vyber predmet</h2>
              
              <div className="grid gap-6">
                {subjects.map(s => {
                  const info = subjectInfo[s];
                  return (
                    <button 
                      key={s}
                      onClick={() => { setSubject(s); loadQ(); }}
                      className={`p-8 bg-gradient-to-r ${info.color} text-white rounded-3xl shadow-2xl hover:scale-105 transition`}
                    >
                      <div className="flex items-center justify-between">
                        <div className="flex items-center gap-4">
                          <span className="text-5xl">{info.icon}</span>
                          <div className="text-left">
                            <h3 className="text-4xl font-bold">{info.name}</h3>
                            <p className="text-lg opacity-90">Neobmedzen√© pr√≠klady</p>
                          </div>
                        </div>
                        <span className="text-4xl">‚Üí</span>
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>
        );
      }

      // ========================================================================
      // RENDER: Learning Interface
      // ========================================================================
      
      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-100 via-purple-100 to-pink-100 p-8">
          <div className="max-w-5xl mx-auto">
            {/* Top Bar */}
            <div className="mb-6 flex justify-between items-center">
              <button onClick={() => setSubject(null)} className="px-4 py-2 bg-white rounded-xl shadow">
                ‚Üê Sp√§≈•
              </button>
              
              <div className="flex gap-3">
                <div className="bg-white px-4 py-2 rounded-xl shadow border-2 border-yellow-400">
                  <span className="font-bold">üèÜ {profile.points}</span>
                </div>
                <div className="bg-white px-4 py-2 rounded-xl shadow border-2 border-purple-400">
                  <span className="font-bold">‚≠ê L{profile.level}</span>
                </div>
              </div>
            </div>

            {/* Phase 1: Example */}
            {phase === 'example' && currentQ && (
              <div className="bg-gradient-to-br from-blue-100 to-cyan-100 rounded-3xl shadow-2xl p-8 mb-6 border-4 border-blue-500">
                <h3 className="text-4xl font-bold mb-6 text-blue-800">üìñ F√°za 1: Uk√°≈æka</h3>
                
                <div className="bg-white rounded-2xl p-6 mb-6">
                  <p className="text-3xl font-bold mb-4">{currentQ.question}</p>
                  {currentQ.steps.map((s, i) => (
                    <p key={i} className="mb-2 text-xl">{s}</p>
                  ))}
                </div>
                
                <button 
                  onClick={() => setPhase('solving')}
                  className="w-full py-4 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-xl font-bold text-xl"
                >
                  Rozumiem ‚Üí Vyrie≈°i≈•
                </button>
              </div>
            )}

            {/* Phase 2: Solving */}
            {phase === 'solving' && currentQ && (
              <div className="bg-gradient-to-br from-green-100 to-emerald-100 rounded-3xl shadow-2xl p-8 mb-6 border-4 border-green-500">
                <h3 className="text-4xl font-bold mb-6 text-green-800">‚úèÔ∏è F√°za 2: Vyrie≈°i≈•</h3>
                
                <div className="bg-white rounded-2xl p-6">
                  <p className="text-3xl font-bold mb-6">{currentQ.question}</p>
                  <div className="flex gap-4">
                    <input
                      type="text"
                      value={answer}
                      onChange={(e) => setAnswer(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && checkAnswer()}
                      className="flex-1 p-4 border-2 rounded-xl text-2xl font-bold"
                      placeholder="Tvoja odpoveƒè..."
                      autoFocus
                    />
                    <button 
                      onClick={checkAnswer}
                      className="px-8 py-4 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-xl font-bold"
                    >
                      ‚úì
                    </button>
                  </div>
                </div>
              </div>
            )}

            {/* Phase 3: Feedback */}
            {phase === 'feedback' && feedback && (
              <div className="bg-white rounded-3xl shadow-2xl p-8 mb-6 border-4">
                <div className={`p-8 rounded-2xl ${
                  feedback.correct 
                    ? 'bg-gradient-to-br from-green-100 to-emerald-100 border-4 border-green-500' 
                    : 'bg-gradient-to-br from-red-100 to-pink-100 border-4 border-red-500'
                }`}>
                  <h3 className="text-5xl font-bold mb-4">
                    {feedback.correct ? '‚úÖ Spr√°vne! üéâ' : feedback.message}
                  </h3>
                  
                  <div className="grid md:grid-cols-3 gap-4 mb-6">
                    <div className="bg-white bg-opacity-50 rounded-xl p-4 text-center">
                      <div className="text-2xl font-bold">{profile.totalQuestions}</div>
                      <div className="text-sm">√öloh celkom</div>
                    </div>
                    <div className="bg-white bg-opacity-50 rounded-xl p-4 text-center">
                      <div className="text-2xl font-bold">{profile.points}</div>
                      <div className="text-sm">Body</div>
                    </div>
                    <div className="bg-white bg-opacity-50 rounded-xl p-4 text-center">
                      <div className="text-2xl font-bold">L{profile.level}</div>
                      <div className="text-sm">Level</div>
                    </div>
                  </div>
                  
                  <button 
                    onClick={loadQ}
                    className="w-full py-5 bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white rounded-xl font-bold text-2xl flex items-center justify-center gap-3"
                  >
                    ƒéal≈°ia √∫loha ‚Üí
                  </button>
                </div>
              </div>
            )}

            {/* XP Bar */}
            <div className="bg-white rounded-2xl p-4 shadow">
              <div className="flex justify-between mb-2">
                <span className="font-bold">Level {profile.level}</span>
                <span className="text-sm">{profile.xp}/{profile.xpToNextLevel} XP</span>
              </div>
              <div className="w-full bg-gray-200 rounded-full h-4">
                <div 
                  className="h-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all"
                  style={{ width: `${(profile.xp / profile.xpToNextLevel) * 100}%` }}
                />
              </div>
            </div>
          </div>

          {toast && (
            <div className={`fixed bottom-6 right-6 px-6 py-4 rounded-xl shadow-2xl text-white font-bold animate-slide-up ${
              toast.type === 'success' ? 'bg-green-500' : 
              toast.type === 'error' ? 'bg-red-500' : 'bg-blue-500'
            }`}>
              {toast.message}
            </div>
          )}
        </div>
      );
    }

    // Render app
    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
